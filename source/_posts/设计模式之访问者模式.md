---
title: 设计模式之访问者模式
date: 2023-10-16 22:42:32
tags: java
---

## 访问者模式

访问者模式是一种行为型设计模式，它允许你在不修改对象结构的情况下定义新操作。该模式中有两个主要参与者：访问者和元素。元素表示对象结构中的一个特定元素，而访问者则定义了在这些元素上执行的新操作。

在访问者模式中，元素对象通常会提供一个 accept() 方法，该方法接受访问者对象作为参数。访问者对象则会包含一系列的 visit() 方法，每个方法对应一个元素对象，并在其上执行特定的操作。

通过使用访问者模式，我们可以将新功能添加到现有的对象结构中，而无需修改它们的类。这使得代码更加灵活和可扩展，并且符合“开闭原则”。同时，访问者模式还可以帮助我们将相关操作逻辑集中在一起，提高代码的可维护性和可读性。

<!-- more -->



## 代码实现

1. 定义元素接口（Element）：这是表示对象结构中元素的接口，其中包含一个 accept() 方法，用于接受访问者对象。

```java
public interface Element {
    void accept(Visitor visitor);
}
```

1. 实现具体元素类（ConcreteElement）：这些类是实现元素接口的具体类，每个类都需要实现 accept() 方法并在其中调用访问者对象的 visit() 方法。

```java
public class ConcreteElementA implements Element {
    @Override
    public void accept(Visitor visitor) {
        visitor.visitConcreteElementA(this);
    }
}

public class ConcreteElementB implements Element {
    @Override
    public void accept(Visitor visitor) {
        visitor.visitConcreteElementB(this);
    }
}
```

1. 定义访问者接口（Visitor）：这是表示访问者的接口，其中包含一系列的 visit() 方法，每个方法对应一个具体元素类。

```java
public interface Visitor {
    void visitConcreteElementA(ConcreteElementA elementA);
    void visitConcreteElementB(ConcreteElementB elementB);
}
```

1. 实现具体访问者类（ConcreteVisitor）：这些类是实现访问者接口的具体类，每个类都需要实现 visit() 方法，并在其中执行特定的操作。

```java
public class ConcreteVisitor implements Visitor {
    @Override
    public void visitConcreteElementA(ConcreteElementA elementA) {
        // 执行针对 ConcreteElementA 的操作
    }

    @Override
    public void visitConcreteElementB(ConcreteElementB elementB) {
        // 执行针对 ConcreteElementB 的操作
    }
}
```

1. 创建对象结构并调用访问者：在客户端代码中，创建具体元素对象并将它们添加到对象结构中。然后，创建访问者对象并在对象结构上调用 accept() 方法。

```java
public class Client {
    public static void main(String[] args) {
        Element elementA = new ConcreteElementA();
        Element elementB = new ConcreteElementB();

        Visitor visitor = new ConcreteVisitor();

        elementA.accept(visitor);
        elementB.accept(visitor);
    }
}
```

这样，当访问者对象在对象结构上执行操作时，会根据实际元素的类型来调用相应的 visit() 方法，并执行特定的操作。通过这种方式，访问者模式可以实现在不修改元素类的情况下，为对象结构添加新的操作。